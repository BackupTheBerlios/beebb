%\documentclass[11pt,oneside]{article}
\documentclass[12pt,a4paper,twoside]{article}

\RequirePackage[T1]{fontenc}
\RequirePackage{times}
%\usepackage[T1]{fontenc}
\RequirePackage[latin2]{inputenc}
\RequirePackage[polish]{babel}
%\usepackage[polish]{babel}

\RequirePackage{comment}

\RequirePackage{a4wide}
\RequirePackage{longtable}
\RequirePackage{multicol}
\RequirePackage{url}
\usepackage[dvips]{color,graphicx}
%\usepackage[latin2]{inputenc}

\author{Pawe³ Boguszewski, Marcin Pruszczyñski}
\title{Dokumentacja forum dyskusyjne Bee}
\date{\today}

\begin{document}
\maketitle
\newpage
\tableofcontents
\newpage
\section{Wprowadzenie}
Poni¿szy dokument na ma celu przedstawienie dokumentacji technicznej dla forum internetowego Bee.
\subsection{Cele projektu}
Celem projektu by³o stworzenie forum internetowego z mo¿liwie jak najlepsz± cache'owalno¶ci±. Forum powinno dorównywaæ funkcjonalno¶ci± komercyjnym odpowiednikom, a tak¿e charakteryzowaæ siê prostot± obs³ugi, szybkim dzia³aniem  i skalowalno¶ci±. 
\subsection{Wybrane technologie}
Do implementacji naszego forum wybrali¶my technologiê java/j2ee oraz relacyjn± bazê danych MySQL. Logika zosta³a napisana w jêzyku java, strony s± generowane za pomoc± JSP, za oskryptowanie stron odpowiada JavaScript. Zawarto¶æ forum przechowywana jest w bazie danych (MySQL), a konfiguracja w plikach XML. 
\subsection{S³ownik}
Aby ujednoliciæ nazewnictwo poszczególnych elementów w czasie naszej pracy wprowadzili¶my s³ownik. Definiuje on pojêcia u¿ywane dalej w dokumencie.
\begin{itemize}
\item Wypowied¼ -- ci±g znaków opatrzony autorem i dat±.
\item W±tek -- lista wypowiedzi, opatrzona  tematem, autorem i dat± powstania. W±tek mo¿e byæ te¿ nazywany Tematem.
\item Podforum -- zbiór w±tków. Ka¿de podforum posiada tytu³.
\item Kategoria -- lista podforów. Kategoria posiada tytu³.
\item Forum -- lista kategorii.
\item Go¶æ -- niezalogowany u¿ytkownik. Pos³uguje siê tymczasow± nazw±.
\item U¿ytkownik (zwyk³y) -- zalogowany u¿ytkownik posiadaj±cy ksywkê(nick), dane osobowe, preferencje itp.
\item Moderator -- zalogowany u¿ytkownik zwyk³y posiadaj±cy uprawnienia do podforum: usuwanie wypowiedzi lub ca³ego w±tku, blokowanie/zamykanie w±tku, zabranianie dostêpu u¿ytkownikom, edytowanie wypowiedzi.
\item Administrator -- u¿ytkownik zwyk³y zalogowany posiadaj±cy najwy¿szy poziom uprawnieñ. W sk³ad uprawnieñ administratora wchodzi konfiguracja ca³ego forum, oraz robienie kopii zapasowych.
\item Zapamiêtywalno¶æ -- polski odpowiednik dla angielskiego s³owa cache'owalno¶æ
\end{itemize}
\subsection{Funkcjonalno¶æ}
Forum podzielone jest na kategorie grupuj±ce podfora. Ka¿de podforum mo¿e staæ siê prywatne -- przez co liczba u¿ytkowników maj±cych prawo odczytu i zapisu do forum stanie siê ograniczona. Do ka¿dego podforum przydzielani s± moderatorzy. W podforach znajduje siê lista w±tków. W±tki mo¿na przenosiæ pomiêdzy podforami. Ka¿dy w±tek ma przyporz±dkowany do siebie zbiór wypowiedzi. Dodawanie w±tków do podforum, mo¿e zostaæ kontrolowane poprzez zabranianie zapisu dla wybranych u¿ytkowników. W±tki wyczerpuj±ce temat mog± zostaæ zamkniête przez moderatora. Je¿eli pojawia siê w±tek nie zwi±zany z tematem forum mo¿e zostaæ usuniêty lub zablokowany.
Zaimplementowali¶my mo¿liwo¶æ umieszczania emotikonek w wypowiedziach, oraz jêzyk (bêd±cy podzbiorem jêzyka HTML) s³u¿±cy do formatowania tekstu wypowiedzi. Emotikonki mog± byæ dodawane oraz edytowane przez administratora.
Ka¿dy zarejestrowany u¿ytkownik naszego forum posiada w³asne spersonalizowane konto. Profil u¿ytkownika pozwala na kontrolê nad danymi osobowymi, a tak¿e nad ich prywatno¶ci±. Zarejestrowany u¿ytkownik posiada wizytówkê, na której wy¶wietlane s± jego dane -- miêdzy innymi imiê, nazwisko, e-mail oraz konta komunikatorów internetowych wraz z jego aktualnym statusem. Wizytówka jest powi±zana z ka¿d± wypowiedzi± napisan± przez u¿ytkownika, dziêki temu czytaj±cy ma do niej dostêp bezpo¶rednio z czytanego w±tku. Forum udostêpnia mo¿liwo¶æ zmiany wygl±du poprzez kaskadowe arkusze stylów. Zarejestrowany u¿ytkownik forum ma mo¿liwo¶æ wyboru stylu wed³ug swoich preferencji.
Po utworzeniu w±tku istnieje mo¿liwo¶æ powiadamiania u¿ytkownika o nowych wypowiedziach pojawiaj±cych siê w w±tku.
Aby u³atwiæ u¿ytkownikom korzystanie z forum, wprowadzili¶my podpowiedzi do wybranych funkcjonalno¶ci -- po najechaniu kursorem na odpowiedni± ikonkê pojawia siê automatycznie tekst z opisem. 
W forum zrezygnowali¶my z dokumentacji dla u¿ytkownika w formie dokumentu tekstowego, skupili¶my siê na podpowiedziach w odpowiednich miejscach w serwisie -- np. w czasie rejestracji u¿ytkownik mo¿e naje¿d¿aj±c na odpowiedni± ikonkê dowiedzieæ siê co dana opcja oznacza, bez konieczno¶ci otwierania dodatkowych stron.
\subsection{Role}
Pracê przy implementacji forum podzielili¶my w nastêpuj±cy sposób:
\begin{itemize}
\item Marcin Pruszczyñski -- kierownik projektu\\ 
Odpowiedzialny za koordynowanie projektem, stronê wizualn± forum a tak¿e czê¶ciowo za logikê. 
\item Pawe³ Boguszewski -- programista\\
Odpowiedzialny za logikê forum.
\item Piotr Sobczak -- programista\\
Odpowiedzialny za panel administratora.
\end{itemize}

\section{Schemat dzia³ania}
\begin{center}\includegraphics[scale=1]{images/layers.eps}\end{center}
\begin{itemize}
\item Connector -- warstwa jest odpowiedzialna za po³±czenie z baz± danych. W zale¿no¶ci od rodzaju bazy danych mo¿na pod³±czyæ ró¿ne connectory.
\item DataBase -- jest odpowiedzialna za pobieranie oraz aktualizacjê obiektów proksy w bazie danych. Jako, ¿e wykorzystujemy relacyjn± bazê danych DataBase jest translatorem pomiêdzy obiektami w javie a baz± danych. Warstwa jest niezale¿na od wykorzystywanej bazy danych.
\item Objects -- proxy -- obiekty reprezentuj±ce logikê forum. Obiekty przechowuj± informacjê o wybranej czê¶ci sk³adowej forum. 
\item JSP -- warstwa prezentacji odpowiedzialna za generowanie wygl±du forum. W tej warstwie znajduj± siê tak¿e skrypty javascript. 
\end{itemize}
\section{Opis techniczny}
Poni¿szy rozdzia³ prezentuje techniczny opis forum. Zawiera przegl±d wybranych przez nas technologii oraz algorytmów.
\subsection{Po³±czenie z baz± danych}
Forum zosta³o zaimplementowane z my¶l± o jak najwiêkszej modularno¶ci, z tego powodu po³±czenie z baz± danych jest obs³ugiwane przez oddzieln± warstwê (Connector). Warstwa korzysta z odpowiedniego sterownika dostarczanego wraz z baz± danych. W naszym przypadku jest to sterownik jdbc przeznaczony dla bazy MySQL.
Po³±czenie z baz± implementuje tylko adapter do bazy, nie zawiera ¿adnych poleceñ SQL. Wszelkie zapytania s± zapisane w jednej z wy¿szych warstw.
Aby mo¿na by³o ³atwo refaktoryzowaæ schemat bazy, wszelkie sta³e -- czyli nazwy tabel, kolumn s± umieszczone w pliku konfiguracyjnym.
Do utworzenia schematu tabel napisali¶my odpowiednie skrypty, które nale¿y uruchomiæ przy instalacji forum. Skrypty zawieraj± zestaw instrukcji w jêzyku SQL tworz±cy tabele i ustawiaj±cy inicjalne warto¶ci.
 W przypadku zmiany bazy danych, wystarczy jedynie dokonaæ zmian w klasie Connector, nie potrzeba ¿adnych wiêkszych ingerencji w implementacjê forum.
\subsection{Obiekty}
Logika forum zosta³a zaprojektowana obiektowo. Ka¿da sk³adowa -- forum, kategoria, podforum, w±tek i wypowied¼ jest reprezentowana jako oddzielna klasa. Warstwa DataBase jest odpowiedzialna za translacjê z bazy danych do obiektów. Obiekty posiadaj± metody do wypisywania kodu JSP -- dziêki czemu mo¿na bezpo¶rednio po³±czyæ je z warstw± wizualn± (JSP).
Klasa reprezentuj±ca forum posiada nazwê, opis a tak¿e listê kategorii wchodz±cych w sk³ad forum. Kategoria posiada podobnie jak forum nazwê i opis, dodatkowo kategoria mo¿e byæ nieaktywna lub prywatna -- wtedy jest widoczna dla wybranej grupy u¿ytkowników. Obiekt reprezentuj±cy kategoriê posiada listê podforów. Podforum przechowuje dane o nazwie, opisie, li¶cie w±tków, a tak¿e o swojej dostêpno¶ci (czy jest aktywne) oraz prywatno¶ci. W obiekcie przechowujemy tak¿e dane statystyczne -- czyli liczbê wypowiedzi i w±tków oraz datê i autora ostatniej wypowiedzi. Klasa opisuj±ca w±tek posiada temat, datê utworzenia, autora, liczbê oraz listê wypowiedzi, a tak¿e datê i autora ostatniej wypowiedzi. W±tek mo¿e byæ w jednym z 4 stanów -- zwyk³y, zamkniêty, zablokowany, nieaktywny. Podobnie jak podforum i kategoria w±tek mo¿emy uczyniæ prywatnym. Wypowied¼ posiada autora, datê oraz tre¶æ. Mo¿emy sterowaæ jej dostêpno¶ci± poprzez uczynienie j± nieaktywn±, lub prywatn±. Tre¶æ wypowiedzi jest ju¿ przygotowana do wy¶wietlenia i nie musi byæ interpretowana przez ¿aden silnik forum. W±tek i podforum potrafi± wy¶wietliæ sam nag³ówek a tak¿e kompletn± tre¶æ, tak wiêc z poziomu widoku forum wo³amy tylko odpowiedni± metodê.
Ka¿da sk³adowa forum mo¿e zostaæ wy¶wietlona jako autonomiczna strona.
Podobnie jak klasy reprezentuj±ce zawarto¶æ forum, u¿ytkownik te¿ jest reprezentowany obiektowo. Ka¿dy zarejestrowany u¿ytkownik posiada konto w serwisie. W momencie logowania tworzona jest instancja klasy reprezentuj±cej u¿ytkownika. Obiekt zawiera m.in. Dane osobowe -- czyli imiê, nazwisko, datê urodzenia, miasto zamieszkania, a tak¿e adres email oraz identyfikatory ró¿nych komunikatorów. Obiekt u¿ytkownik pamiêta tak¿e datê ostatniego zalogowania, uprawnienia (moderator, administrator), a tak¿e styl i jêzyk.
Za zarz±dzanie konfiguracj± forum jest odpowiedzialny obiekt klasy Config. Pobiera on konfiguracjê z pliku XML. Zawiera warto¶ci ustawieñ poszczególnych sk³adowych forum (np. parametry bazy danych,serwera pocztowego, tre¶ci maili wysy³anych do u¿ytkowników itp. ...). Za edycjê ustawiañ przechowywanych w obiekcie klasy Config jest odpowiedzialny panel administratora.
Klasa Messages jest odpowiedzialna za zarz±dzanie wersjami jêzykowymi na forum. Ka¿dy komunikat wy¶wietlany u¿ytkownikowi jest pobierany z obiektu tej klasy. W przypadku zmiany jêzyka obiekt klasy Messages musi wczytaæ warto¶ci z odpowiedniego pliku jêzykowego.
\subsection{Uk³ad stron}
W tym rozdziale zawarty jest opis jak projekt zosta³ zorganizowany pod wzglêdem uk³adu i budowy poszczególnych stron sk³adaj±cych siê na ca³e forum dyskusyjne. Obejmuje on technologiê, za³o¿enia projektu jak i po czê¶ci funkcjonalno¶æ o jak± wzbogacone zosta³o forum pod k±tem wygl±du.
\subsubsection{Wygl±d}
Projekt Bee zosta³ zaprojektowany z my¶l± o ³atwej personalizacji wygl±du forum. S³u¿yæ maj± do tego pliki z Kaskadowymi Arkuszami Stylów (Cascading Style Sheets -- CSS). Jednak aby mo¿na by³o siê wygodnie pos³u¿yæ t± technik± oraz wykorzystaæ jak najwiêcej mo¿liwo¶ci jakie oferuje, niezbêdne jest odpowiednie nazewnictwo obiektów wystêpuj±cych na generowanych przez nas stronach. W zwi±zku z tym ka¿dy znacz±cy znacznik sk³adaj±cy siê na strony forum zosta³ opatrzony odpowiednim atrybutem class. Dziêki takiemu rozwi±zaniu otrzymali¶my wysok± elastyczno¶æ w komponowaniu wygl±du wy¶wietlanych stron. Decyzja o zastosowaniu plików CSS zosta³a podjêta jeszcze przed przyst±pieniem do implementacji. Ponadto zosta³ przygotowany ''szablon wygl±du ostatecznego'' projektu Bee. Szablon ten to strony w jêzyku XHTML przedstawiaj±cy wygl±d do jakiego d±¿yli¶my podczas implementacji forum. Definiuje on tak¿e atrybuty class poszczególnych znaczników wystêpuj±cych na stronach. Zawiera wstêpn± implementacjê funkcji w jêzyku JavaScript, których celem by³o przetestowanie mo¿liwo¶ci i ograniczeñ podczas poprawnej obs³ugi wy¶wietlanych przez nas ramek zagnie¿d¿onych. Szablon przyczyni³ siê do znacznego zmniejszenia nak³adu pracy potrzebnego na ostateczn± implementacjê. Dziêki takiemu rozwi±zaniu programi¶ci w zespole nie musieli dbaæ o finalny wygl±d pisanych przez nich stron gdy¿ ich struktura by³a z góry sztywno okre¶lona. Ponadto wyeliminowali¶my mo¿liwo¶æ prostych do pope³nienia, a trudnych w diagnozowaniu b³êdów na stronach w projekcie.
Forum posiada dobrze usystematyzowane atrybuty class w ka¿dym z jego elementów. Dziêki temu ³atwo jest dostarczyæ u¿ytkownikom szeroki wachlarz dostêpnych konfiguracji wygl±du. Co wiêcej planujemy udostêpniæ mo¿liwo¶æ samodzielnego wprowadzania zmian w wygl±dzie forum. Bêdzie mo¿na modernizowaæ wygl±d poprzez specjalnie przygotowan± w tym celu stronê, na której u¿ytkownik bêdzie móg³ w intuicyjny sposób samodzielnie edytowaæ styl forum. 
\subsubsection{Wielojêzyczno¶æ}
Podczas pisania projektu jakim jest forum dyskusyjne nie wolno pomin±æ zagadnienia poprawnego wy¶wietlania i obs³ugi wielu ró¿nych jêzyków. Dlatego projekt Bee opiera siê w ca³o¶ci na kodowaniu UTF-8 co daje szeroki wachlarz obs³ugiwanych jêzyków bez konieczno¶ci zmiany strony kodowej wy¶wietlanych stron w jêzyku xhtml. Za³o¿enia implementacyjne zosta³y posuniête o krok dalej i objê³y tak¿e wszystkie informacje tekstowe wystêpuj±ce w projekcie. W tym celu zosta³a utworzona klasa Messages.java zawieraj±ca wszystkie s³owa, frazy, komunikaty i informacje, które pojawiaj± siê na stronach forum. Podczas generowania stron xhtml w kodzie JSP programista nie mia³ prawa u¿ywaæ jawnie pisanego tekstu. W efekcie otrzymali¶my bardzo prosty sposób na podmianê jêzyka forum dyskusyjnego na inny dowolny dostarczony w przysz³o¶ci z wersj± dystrybucyjn± projektu lub na zdefiniowany przez administratora forum. Klasa Messages zostanie wzbogacona o mechanizmy odczytu zdefiniowanych fraz i s³ów z plików XML. Odbêdzie siê to bez potrzeby jakichkolwiek zmian w pozosta³ej czê¶ci projektu.
Projekt Bee dostarcza mo¿liwo¶æ ustawienia komunikatów wysy³anych do u¿ytkowników drog± poczty elektronicznej. Administrator zarz±dzaj±cy forum dyskusyjnym ma mo¿liwo¶æ samodzielnego okre¶lenia tre¶ci wysy³anych automatycznie wiadomo¶ci. Takie rozwi±zanie pozwala na roz³±czna konfiguracjê jêzyka w takim wy¶wietlane s± komunikaty forum oraz jêzyka i samej tre¶ci wysy³anych listów powiadamiaj±cych na przyk³ad o potrzebie dokoñczenia procesu rejestracji. 
\subsubsection{Emotikony}
Forum dyskusyjne to miejsce gdzie u¿ytkownicy sieci mog± wymieniaæ siê pogl±dami na konkretne wybrane przez siebie tematy. Podstawow± funkcjonalno¶ci± jest przede wszystkim mo¿liwo¶æ wypowiedzenia siê czyli wpisania dowolnego tekstu do istniej±cego w±tku lub do nowo stworzonego. Jednak na rynku istnieje wiele for dyskusyjnych do których pisz±c projekt starali¶my siê co najmniej dorównaæ czê¶ci± funkcjonalno¶ci. Dlatego te¿ projekt Bee zosta³ wzbogacony o mo¿liwo¶æ upiêkszania wypowiedzi poprzez dodawanie do nich tak zwanych emotikonek czyli ma³ych plików graficznych przedstawiaj±cych symbolicznie mimikê twarzy ludzkiej lub zachowañ ludzkich.
Wraz z wersja dystrybucyjn± dostarczony jest zestaw emotikonek domy¶lnych sk³adaj±cy siê z oko³o 30 plików graficznych. Dodawanie emotikonki do wypowiedzi sprowadza siê do umieszczenia odpowiedniego znacznika w jej tre¶ci. Format znacznika ten jest z góry okre¶lony i ma postaæ:
					 $$:|<nazwa>|:$$
gdzie $<nazwa>$ to nazwa znacznika jednoznacznie okre¶laj±ca wybrany plik graficzny. Dla wygody u¿ytkownika zosta³a przygotowana funkcja dodawania ikon przy u¿yciu funkcji JavaScript, która uzupe³nia edytowan± wypowied¼ o wybrany plik graficzny.
Wy¿ej wymienione znaczniki zostaj± zamienione na znaczniki img jêzyka xhtml odnosz±ce siê do konkretnego pliku graficznego. Dla poprawy wydajno¶ci znaczniki projektu Bee zostaj± zamienione na znaczniki xhtml ju¿ podczas zapamiêtywania wypowiedzi u¿ytkownika. Dziêki temu pó¼niejsze wy¶wietlanie wypowiedzi nie wymaga ¿adnych dodatkowych operacji. 
Znaczniki projektu Bee s± w pe³ni konfigurowalne. Administrator forum ma mo¿liwo¶æ okre¶lenia nazw znaczników oraz ¶cie¿ki do plików graficznych do jakich siê one odnosz±. Co wiêcej ¶cie¿ki mog± odnosiæ siê do plików lokalnie znajduj±cych siê na serwerze z forum dyskusyjnym, ale tak¿e do plików znajduj±cych siê na innym serwerze sieciowym.
\subsubsection{JavaScript}
W projekcie Bee zosta³ intensywnie wykorzystany jêzyk JavaScript. Wszystkie formularze wype³niane przez u¿ytkownika sprawdzane s± wstêpnie przed wys³aniem zapytania na serwer. Kontrola obejmuje miêdzy innymi wype³nienie wymaganych pól, poprawno¶æ d³ugo¶ci has³a czy identyczno¶æ powtórzonego has³a. Dziêki temu u¿ytkownik jeszcze przed wys³aniem ¿±dania do serwera otrzyma komunikat o b³êdzie. Na uwagê zas³uguje fakt i¿ pliki z funkcjami JavaScript zawarte w projekcie s± w pe³ni zapamiêtywane przez po¶redników w sieci, a to za sprawa ich niezmienno¶ci. Co wiêcej pliki te pozostaj± nienaruszone nawet po zmianie jêzyka w jakim ca³e forum porozumiewa siê z u¿ytkownikiem. Osi±gnêli¶my to dziêki przekazywaniu wszystkich potrzebnych komunikatów do funkcji na poziomie generowanego kodu w jêzyku xhtml.
 Skrypt JavaScript obejmuj± jednak tak¿e znacznie wa¿niejsze funkcje w projekcie. Miêdzy innymi kontrola rozmiaru ramek zagnie¿d¿onych, które stanowi± podstawê uk³adu stron na forum. Kontrola polega na zmianie rozmiaru ramek zatopionych jak i otaczaj±cych j± elementów. Celem jest taka zmiana rozmiaru elementów aby unikn±æ niepo¿±danego efektu jakim jest mo¿liwo¶æ przesuwania siê zawarto¶ci ramek zagnie¿d¿onych.
Kolejn± wa¿n± funkcj± jest podmiana ramki widocznej z ramk± aktualnie stanowi±c± bufor. Wiêcej na ten temat w rozdziale ''Ramki zagnie¿d¿one''.
\subsubsection{Chmurki podpowiedzi}
Forum dyskusyjne Bee zosta³o wyposa¿one w system podpowiedzi i pomocy. Z wykorzystaniem skryptów JavaScript stworzyli¶my funkcje odpowiedzialne za tworzenie chmurek podpowiedzi popularnie zwanymi angielskim s³owem hint oraz za kasowanie podpowiedzi po opuszczeniu przez kursor myszy obszaru obiektu nad którym wy¶wietlana by³a podpowied¼. Dzia³anie skryptu opiera siê na modyfikacji drzewa dokumentu xhtml, a konkretnie na dodawaniu nowego elementu i pozycjonowaniu go nad wybranym elementem podczas zdarzenia najechania kursora myszki nad element oraz na kasowaniu wcze¶niej utworzonego dodatkowego elementu po wycofaniu kursora muszy z nad danego elementu. Skrypty odpowiedzialne za system pomocy s± w pe³ni zapamiêtywane przez po¶redników sieciowych. Ponadto istnieje tak¿e funkcja sprawdzaj±ca czy u¿ytkownik ogl±daj±cy forum jest zalogowany. Jej dzia³anie opiera siê na sprawdzeniu czy zosta³o ustawione ciasteczko w przegl±darce. Dziêki tej funkcji mo¿liwe jest wy¶wietlanie ró¿nych komunikatów pomocy dla u¿ytkownika zalogowanego i go¶cia. Oczywistym jest fakt, i¿ chmurki nie powinny zawieraæ tre¶ci prywatnych gdy¿ s± dostêpne pomimo nie zalogowania siê.
\subsubsection{Komunikatory i dostêpno¶æ kontaktów}
Nasze forum daje mo¿liwo¶æ zdefiniowania kont lub numerów wielu popularnych komunikatorów internetowych ka¿demu z zarejestrowanych u¿ytkowników. Ka¿demu u¿ytkownikowi po¶wiecona jest oddzielna strona prezentuj±ca jego profil, na której za jego zgod± mo¿emy poznaæ wpisane przez niego dane. Dodatkow± funkcjonalno¶ci± jest wy¶wietlanie dostêpno¶ci kont komunikatorów. Zadanie jest proste w przypadku komunikatorów takich jak Gadu-Gadu, Tlen czy ICQ, jednak sieæ Jabber czy MSN nie udostêpniaj± serwisów z informacjami o statusie kontaktów tych sieci. Jednak dziêki serwisowi http://www.onlinestatus.org/ mo¿liwe jest otrzymanie informacji o dostêpno¶ci tak¿e dla tych komunikatorów. Co wiêcej planujemy udostêpniæ administratorowi forum mo¿liwo¶æ uruchomienia serwera Online Status Indicator (OSI) dziêki czemu nie bêdzie on musia³ liczyæ na niezawodne dzia³anie zewnêtrznych serwerów. Panel administratora zostanie wtedy wzbogacony o mo¿liwo¶æ samodzielnego zdefiniowania serwera z us³ug± OSI. 

\subsection{Ramki zagnie¿d¿one}
Jednym z g³ównych za³o¿eñ projektu Bee by³o wymaganie jak najwy¿szej zapamiêtywalno¶ci podstron forum przez po¶redników sieciowych. W tym celu postanowili¶my podzieliæ forum dyskusyjne na jak najwiêcej niezale¿nych od siebie i niezmiennych w czasie czê¶ci. Oczywistym jest fakt i¿ do takich czê¶ci zaliczaj± siê pliki graficzne, pliki zawieraj±ce kaskadowe arkusze stylów czy pliki z funkcjami w JavaScript. Jednak wa¿niejsze by³o wyodrêbnienie i podzia³ stron serwisu na mniejsze podstrony. Postanowili¶my komponowaæ ostateczny, wy¶wietlany wynik u¿ytkownikowi z mniejszych niezale¿nych od siebie podstron. W tym celu pos³u¿yli¶my siê ramkami zagnie¿d¿onymi. Podzia³u dokonali¶my ju¿ na poziomie najwy¿szym. Forum dyskusyjne sk³ada siê z dwóch ramek: menu górnego -- dalej zwan± ramk± nag³ówka oraz g³ównej czê¶ci forum -- dalej zwan± ramka tre¶ci, w której prezentujemy zawarto¶æ. Dodatkowo podzia³owi uleg³a tak¿e prezentacja zawarto¶ci w±tku. Ka¿dy w±tek sk³ada siê z wypowiedzi, a ka¿dej z nich odpowiada ramka zagnie¿d¿ona odwo³uj±ca siê do strony z jej zawarto¶ci±. Ka¿dy element forum to autonomiczna strona. Co wiêcej do ka¿dej z tych stron u¿ytkownik mo¿e odwo³aæ siê bezpo¶rednio z pominiêciem pozosta³ych otaczaj±cych go ramek. Takie rozwi±zanie pozwala czytelnikom na przekazywanie sobie odno¶ników bezpo¶rednio do konkretnych dyskusji, tematów czy wypowiedzi co zaoszczêdza ich czas i skraca ¶cie¿kê przej¶æ miêdzy stronami do zera.
\subsubsection{Podwójny bufor ramek}
Pod koniec realizacji projektu pojawi³a siê zmiana specyfikacji, któr± pragnêli¶my uwzglêdniæ w swoim forum dyskusyjnym. Wymaganie dotyczy³o zmiany zawarto¶ci ramek zagnie¿d¿onych. Celem by³a taka manipulacja przegl±dark± internetow± aby podczas przechodzenia z jednej podstrony na drug± niezauwa¿alne dla u¿ytkownika sta³o siê wczytywanie kolejnej strony. Zawarto¶æ starej strony mia³a nie znikn±æ do póki zawarto¶æ nowej strony nie bêdzie gotowa do wy¶wietlenia. Rozwi±zanie problemu musia³o uwzglêdniaæ ju¿ wykonan± prace i wymagane w niej zmiany, nak³ad pracy jaki by³by potrzebny na implementacjê w stosunku do czasu jaki pozosta³ do zamkniêcia projektu oraz przede wszystkim efekt koñcowy. Podstawowym rozwi±zaniem by³o zastosowanie funkcji JavaScript XMLHttpRequest(). Jednak musieli¶my odrzuciæ je ze wzglêdu na zbyt du¿± liczbê zmian w projekcie potrzebn± do zastosowania tej metody. Alternatywnie pos³u¿yli¶my siê pomys³em w³asnym jakim by³o wprowadzenie dodatkowej ramki zagnie¿d¿onej bêd±cej wierna kopi± ramki tre¶ci. Obie ramki znajduj± siê dok³adnie w tym samym miejscu na wy¶wietlanej stronie. Podczas gdy u¿ytkownik odwiedza nasz serwis zachowany jest niezmiennik: zawsze jest widoczna tylko jedna z dwóch ramek. Schemat dzia³ania polega na wczytaniu zawarto¶ci kolejnej wy¶wietlanej strony do ramki ukrytej. Kiedy zakoñczy siê pobieranie nowej strony nastêpuje zamiana widoczno¶ci obu ramek. Widoczna staje siê zawarto¶æ nowej strony, a ramka ze strona poprzednia zostaje ukryta. Wynikiem jest spe³nienie wymagañ specyfikacji przy zachowaniu dotychczasowej implementacji praktrycznie bez zmian. 
Opisany efekt uzyskujemy przy pomocy skryptów JavaScript. Ka¿dy odno¶nik znajduj±cy siê w projekcie zosta³ zast±piony automatycznie przez obiekt reaguj±cy na przyci¶niêcie klawisza myszki. Powoduje to inicjalizacjê wczytywania zawarto¶ci kolejnej strony do odpowiedniej ramki ukrytej. Ka¿da strona forum zosta³a opatrzona funkcj± uruchamian± po zakoñczeniu wczytywania jej zawarto¶ci, która powoduje zmianê widoczno¶ci ramek. Schemat ten mo¿na porównaæ do podwójnego buforowania stosowanego powszechnie w grafice komputerowej.
\subsection{Zapamiêtywalno¶æ}
Jednym z g³ównych wymagañ postawionych przed projektem by³a maksymalizacja zapamiêtywalno¶ci forum dyskusyjnego przez po¶redników sieciowych. Temat ten zosta³ ju¿ kilkakrotnie poruszony w niniejszym dokumencie. Rozdzia³ ten po¶wiêcony jest wy³±cznie temu zagadnieniu, opisuje decyzje jakie podjêli¶my w celu osi±gniêcia sukcesu i wyja¶nia ich dzia³anie.
Projekt Bee opiera siê o technologiê JSP, a wiêc zawarto¶æ stron forum generowana jest dynamicznie co sprawia, ¿e jakiekolwiek zapamiêtywanie takich stron jest albo niemo¿liwe albo znacznie utrudnione. Aby temu zaradziæ nale¿y samodzielnie kontrolowaæ nag³ówki odpowiedzi HTTP informuj±c po¶redników sieciowych o zmianach w zawarto¶ci strony. W projekcie pos³ugujemy siê nag³ówkami Cache-Control oraz Expires. Rozró¿niamy dwa rodzaje stron: trwa³e na zawsze oraz nietrwa³e od samego pocz±tku. Do pierwszej grupy zaliczyli¶my strony z Wypowiedziami. Wszystkie pozosta³e strony nale¿± do grupy drugiej. W przysz³o¶ci zamierzamy dok³adniej kontrolowaæ trwa³o¶æ stron poprzez zapisywanie daty ostatniej modyfikacji oraz obs³ugê zapytañ HTTP o zmiany dokumentu od podanego miejsca w czasie. 
\subsubsection{Adresy podstron}
Jedn± z podstawowych decyzji by³o przyjêcie, i¿ ka¿dy element forum bêdzie posiada³ swój unikalny adres. £atwo to osi±gnêli¶my poprzez wprowadzenie do adresu identyfikatora danego obiektu. Identyfikator to numer, który pochodzi z bazy danych i jest kluczem g³ównym dla obiektu. Numer ten zostaje przekazany do podstrony z wykorzystaniem metody GET. Wybór tej metody zosta³ podyktowany lepszymi w³a¶ciwo¶ciami zapamiêtywania ni¿ alternatywna metoda  POST. Metoda GET zosta³a wybrana jako podstawowa dla przekazywania informacji do stron forum. Wyj±tek stanowi± tutaj formularze, jednak ju¿ sama ich obecno¶æ na stronie ogranicza  zapamiêtywanie jej przez po¶redników sieciowych. Nie stanowi to jednak du¿ego problemu gdy¿ zmiana zawarto¶ci strony pod wp³ywem ¿±dania HTTP z przekazanymi parametrami metod± POST nie powinna byæ zapamiêtywana. Zmieniona zawarto¶æ w znacznej mierze dotyczy jedynie pojedynczych u¿ytkowników.
Wa¿nym postanowieniem projektu by³a niezmienno¶æ adresu stron odnosz±cych siê do tre¶ci wypowiedzi. Za³o¿yli¶my, ¿e ka¿da zmiana w jej zawarto¶ci powodowaæ bêdzie zmianê adresu strony, która j± wy¶wietla. Zatem edycja tekstu wypowiedzi spowoduje utworzenie nowego o nowym unikatowym identyfikatorze obiektu. Stary obiekt pozostaje bez zmian. Poci±ga to za sob± konieczno¶æ zmian na stronach prowadz±cych do danej wypowiedzi, a wiêc modyfikacje struktury w±tku, który j± zawiera. Dziêki niezmienno¶ci wypowiedzi mo¿emy poinformowaæ po¶redników w sieci, ¿e wa¿no¶æ strony nigdy nie wygasa, co daje bardzo wysoki wspó³czynnik zapamiêtywalno¶ci. 
Pozosta³e adresy stron s± sta³e jednak ich zawarto¶æ ulega zmianie. Takie podej¶cie eliminuje ich zapamiêtywanie przez po¶redników sieciowych. Jednak nawet je¶li przy ka¿dej zmianie zawarto¶ci ulega³by zmianie tak¿e adres strony, to zysk na zapamiêtywaniu by³by znikomy. Dzieje siê tak dlatego, ¿e czêstotliwo¶æ zmian elementów ró¿nych od wypowiedzi jest bardzo intensywna. Zatem zapamiêtane strony bardzo szybko by siê dezaktualizowa³y i zysk by³by niezauwa¿alny.
\subsubsection{Dowód dobrej zapamiêtywalno¶ci forum}
Jak siê okazuje wysoki wspó³czynnik zapamiêtywania wypowiedzi daje powody do zdefiniowania ca³ego forum jako wysoce zapamiêtywanego. Rozpatrzmy jedynie d³ugo¶ci tekstów wpisywanych przez u¿ytkowników, pomijaj±c d³ugo¶ci wy¶wietlanych dat, nazw u¿ytkowników, liczb itp. Za³ó¿my, ¿e ¶redniej d³ugo¶ci tytu³ w±tku sk³ada siê z 50 znaków, gdy¿ maksymalna jego d³ugo¶æ nie przekracza 100 znaków. Niech wypowied¼ ¶rednio sk³ada siê z 4 zdañ. Na zdanie przeciêtnie sk³ada siê 6 s³ów, które ¶rednio maj± d³ugo¶æ 6 znaków. Po przeliczeniu otrzymujemy, ¿e d³ugo¶æ wypowiedzi ¶rednio wynosi 144 znaków. Do tej warto¶ci nale¿y dodaæ jeszcze znaki bia³e i interpunkcyjne, a tak¿e znaczniki emotikonek. Poniewa¿ za³o¿yli¶my, ¿e zdania s± proste, zatem przyjmiemy po jednym znaku interpunkcyjnym na zdanie. Z ka¿dym s³owem zwi±¿emy jeden znak bia³y. Za³ó¿my, ¿e ¶rednio u¿ytkownicy umieszczaj±c od 2 do 3 emotikonek w jednej wypowiedzi. Emotikonki to znaczniki ¶redniej d³ugo¶ci 7 znaków. Po zsumowaniu wszystkich warto¶ci otrzymujemy szacunkow± d³ugo¶æ wypowiedzi jak± jest 200 znaków. Przyjmuj±c, ¿e na jeden w±tek sk³adaj± siê przeciêtnie 5 wypowiedzi otrzymujemy stosunek wielko¶ci w±tków do wypowiedzi wynosz±cy 5/100. Jak ³atwo zauwa¿yæ w±tki to jedynie 5% ca³ej zawarto¶ci serwisu. Na tej podstawie mo¿na stwierdziæ, i¿ wypowiedzi stanowi± wiêcej ni¿ 90% tre¶ci forum. W po³±czeniu z faktem niezmienno¶ci podstron reprezentuj±cych wypowiedzi dowiedli¶my, i¿ projekt posiada w³asno¶æ zapamiêtywania przez po¶redników sieciowych. 
\subsubsection{Utrata zapamiêtywania kosztem funkcjonalno¶ci}
Podczas realizacji projektu starali¶my siê osi±gn±æ jak najwy¿sz± funkcjonalno¶æ forum dyskusyjnego. Jednocze¶nie jednak g³ównym zadaniem zawartym w specyfikacji by³ wysoki stopieñ zapamiêtywania stron sk³adaj±cych siê na serwis przez po¶redników sieciowych. Jak siê okaza³o nie wszystkie funkcje da³o siê pogodziæ ze stawianym przed nami wymogiem. £atwo zauwa¿yæ, ¿e je¿eli strona jest zapamiêtywana przez po¶rednika to tracimy mo¿liwo¶æ kontrolowania dostêpu do jej zawarto¶ci. Dlatego je¶li chcemy daæ mo¿liwo¶æ uczynienia kategorii forum prywatn±, a wiêc dostêpn± jedynie po zalogowaniu siê do serwisu, to stajemy przed wyborem po¶wiêcenia bezpieczeñstwa lub zapamiêtywalno¶ci. Dzieje siê tak poniewa¿ przy zezwoleniu na zapamiêtywanie strony z zawarto¶ci± chronion±, pierwsze odwo³anie do niej autoryzowanego u¿ytkownika spowoduje, i¿ ka¿de kolejne mo¿e odbyæ siê bez naszego udzia³u, a co za tym idzie z pominiêciem mechanizmu zabezpieczaj±cego tre¶æ. Dlatego postanowili¶my zabroniæ zapamiêtywania, poprzez ustawienie odpowiednich nag³ówków protoko³u HTTP stron, które zawieraj± tre¶ci zdefiniowane przez administratora forum jako prywatne. 
\subsubsection{Realizacja zapamiêtywania przez po¶redników}
Projekt Bee zosta³ zaimplementowany z przeznaczeniem na serwer TomCat. ¦wiadomie wykorzystujemy jego funkcjonalno¶æ dlatego te¿ pliki graficzne, pliki z zawarto¶ci± arkuszy styli oraz z funkcjami w jêzyku JavaScript s± automatycznie opatrywane odpowiednimi nag³ówkami HTTP przez serwer TomCat bez dodatkowych czynno¶ci ze strony programistów. Nag³ówki te s± bardzo szczegó³owe i uwzglêdniaj± datê ostatniej modyfikacji danego pliku informuj±c o tym po¶redników. 
Aby strony sk³adaj±ce siê na forum zosta³y zapamiêtane pos³u¿yli¶my siê nag³ówkami HTTP do okre¶lenia ich daty wa¿no¶ci lub czasu podanego w sekundach przez jaki ich zawarto¶æ jest aktualna. Wszystkie strony zawieraj±ce wypowiedzi u¿ytkowników uznali¶my za niezmienne i dlatego oznaczone s± jako trwa³e przez okres jednego roku od daty odwo³ania na serwer. Taki okres czasu zapewnia wystarczaj±co wysoki stopieñ zapamiêtywania. Pozosta³e strony projektu oznaczone s± z góry jako nietrwa³e i wymagaj±ce aktualizacji. W przysz³o¶ci planujemy obs³ugiwaæ zapytania po¶redników o datê ostatniej zmiany dokumentu. Oczywi¶cie bêdzie to mia³o sens jedynie na stronach, które ulegaj± zmian± stosunkowo rzadko gdy¿ ka¿da ich zmiana powodowaæ bêdzie aktualizacje wewnêtrznych struktur potrzebnych na implementacjê mechanizmu odpowiedzi co w efekcie przyczyni³oby siê do spadku wydajno¶ci forum dyskusyjnego. 
Aby jednak dobrze kontrolowaæ nag³ówki postanowili¶my zrezygnowaæ z mechanizmu sesji oferowanego przez serwer TomCat. Dziêki temu dok³adnie wiadomo kiedy w projekcie wystêpuj± nag³ówki takie jak setCookie, które mog± powodowaæ utrudnienie b±d¼ nawet ca³kowit±  utratê zapamiêtywania serwisu. Dodatkowo nie wystêpuj± nag³ówki zawieraj±ce losow± kombinacjê kilkunastu cyfr stanowi±cych identyfikator sesji, który móg³ tak¿e negatywnie wp³ywaæ na stopieñ zapamiêtywalno¶ci forum. Wy³±czenie mechanizmu sesji pozbawi³o nas jednak wygodnego mechanizmu przechowywania np. obiektu odpowiedzialnego za po³±czenie z baz± danych, za autoryzacjê u¿ytkowników lub konfiguracjê ca³ego serwisu. 
	$$<jsp:useBean id=''mybean'' scope=''session'' class=''className''/>$$
Nie mogli¶my skorzystaæ z powy¿szego mechanizmu przechowywania tych obiektów w sesji gdy¿ ta nie istnia³a. Pos³u¿yli¶my siê natomiast kontekstem servletu, w ramach którego wykonywane s± pliki JSP. Wykorzystali¶my fakt, i¿ s± one kompilowane i wykonywane jako servlety. Postanowili¶my utrzymywaæ wspomniane obiekty jako zmienne statyczne klasy servletu. W ten sposób mogli¶my miêdzy innymi zaimplementowaæ utrzymywanie jednego otwartego po³±czenie z baz± danych co przyczyni³o siê do poprawy wydajno¶ci serwisu. 

\section{Zakoñczenie}
Ostateczna forma projektu Bee stoi na wysokim poziomie. Funkcjonalno¶æ forum jest wysoka i mo¿e byæ porównywana z tak powa¿nymi i popularnymi konkurentami jak na przyk³ad phpBB. Jednocze¶nie posiada cechy, którymi nie odznaczaj± siê podobne serwisy. Do tych mo¿na zaliczyæ uwzglêdnienie zapamiêtywania stron przez po¶redników sieciowych oraz dba³o¶æ o wysokie bezpieczeñstwo forum i tre¶ci w nim zawartych. Wszystko to przy jednoczesnym zachowaniu prostoty i intuicyjnego interfejsu u¿ytkownika.

\end{document}
